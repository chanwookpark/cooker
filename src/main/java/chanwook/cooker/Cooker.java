package chanwook.cooker;import javax.servlet.http.Cookie;import javax.servlet.http.HttpServletRequest;import java.util.Collection;import java.util.Map;/** * Created by chanwook on 2014. 3. 1.. */public class Cooker {    private static final String DEFAULT_CHARSET_NAME = "UTF-8";    private static final String DEFAULT_COOKIE_VALUE_DELIMITER = "~";    private String domainPattern;    private CookieStore cookieStore = new InMemoryCookieStore();    private String charsetName = DEFAULT_CHARSET_NAME;    private String cookieValueDelimiter = DEFAULT_COOKIE_VALUE_DELIMITER;    public Cooker() {    }    public Cooker(String charsetName) {        this.charsetName = charsetName;    }    public Cooker(String charsetName, String domainPattern) {        this.charsetName = charsetName;        this.domainPattern = domainPattern;    }    /**     * Cookie를 새로 굽는다     *     * @param key     * @param value     * @return     */    public CookiePrototype cooking(String key, String value) {        Cookie cookie = new Cookie(key, value);        if (this.getDomainPattern() != null && this.getDomainPattern().length() > 0) {            cookie.setDomain(this.getDomainPattern());        }        return cooking(cookie);    }    /**     * Cookie를 새로 굽는다     *     * @param cookie     * @return     */    public CookiePrototype cooking(Cookie cookie) {        cookieStore.add(cookie);        return new CookiePrototype(cookie.getName(), this);    }    /**     * 두 번째 파라미터로 전달되는 Map은 delimited로 구분되는 String 문자열로 변환되어 쿠키의 값으로 전달됨     *     * @param key     * @param valueMap     * @return     */    public CookiePrototype cooking(String key, Map<String, String> valueMap) {        StringBuilder b = new StringBuilder();        for (Map.Entry<String, String> e : valueMap.entrySet()) {            b.append(e.getKey());            b.append("=");            b.append(e.getValue());            b.append(cookieValueDelimiter);        }        String cookieValue = b.toString();        if (cookieValue.endsWith(cookieValueDelimiter)) {            cookieValue = cookieValue.substring(0, cookieValue.length() - 1);        }        return cooking(key, cookieValue);    }    /**     * 요청 쿠키 정보(HttpServletRequest.getCookies())를 Cooker의 쿠키맵에 저장     *     * @param request     */    public void initialize(HttpServletRequest request) {        Cookie[] cookies = request.getCookies();        for (Cookie c : cookies) {            this.cookieStore.add(c);        }    }    /**     * 전체 Cookie 값을 List 타입으로 반환     *     * @return     */    public Collection<Cookie> toList() {        return cookieStore.getAll();    }    /**     * 전체 Cookie 값을 Map 타입으로 반환     *     * @return     */    public Map<String, Cookie> toMap() {        return cookieStore.getAllAsMap();    }    public Cookie getCookie(String key) {        return cookieStore.get(key);    }    public CookiePrototype getPrototype(String key) {        return new CookiePrototype(key, this);    }    public String getCharsetName() {        return charsetName;    }    public void setCharsetName(String charsetName) {        this.charsetName = charsetName;    }    public String getDomainPattern() {        return domainPattern;    }    public String getCookieValueDelimiter() {        return cookieValueDelimiter;    }}